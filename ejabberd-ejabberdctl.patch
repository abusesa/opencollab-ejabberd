diff -up ejabberd-15.10/ejabberdctl.template.ejabberdctl ejabberd-15.10/ejabberdctl.template
--- ejabberd-15.10/ejabberdctl.template.ejabberdctl	2015-10-28 16:53:12.000000000 +0200
+++ ejabberd-15.10/ejabberdctl.template	2015-11-11 18:18:27.003763012 +0200
@@ -7,15 +7,18 @@ ERL_MAX_PORTS=32000
 ERL_PROCESSES=250000
 ERL_MAX_ETS_TABLES=1400
 FIREWALL_WINDOW=""
-ERLANG_NODE=ejabberd@localhost
+ERLANG_NODE=ejabberd@`hostname -s 2>/dev/null || echo "localhost"`
 
 # define default environment variables
 SCRIPT_DIR=`cd ${0%/*} && pwd`
 ERL={{erl}}
 IEX={{bindir}}/iex
 EPMD={{bindir}}/epmd
-INSTALLUSER={{installuser}}
-ERL_LIBS={{libdir}}
+INSTALLUSER=ejabberd
+ERL_LIBS={{libdir}}/ejabberd
+
+# don't create world readable files
+umask 007
 
 # check the proper system user is used if defined
 if [ "$INSTALLUSER" != "" ] ; then
@@ -27,7 +30,7 @@ if [ "$INSTALLUSER" != "" ] ; then
                 mkdir -p "$INSTALLUSER_HOME"
                 chown "$INSTALLUSER" "$INSTALLUSER_HOME"
             fi
-            EXEC_CMD="su $INSTALLUSER -c"
+            EXEC_CMD="/sbin/runuser -s /bin/bash $INSTALLUSER -c"
         fi
     done
     if [ `id -g` -eq `id -g $INSTALLUSER` ] ; then
@@ -84,16 +87,14 @@ if [ "$ERLANG_NODE_ARG" != "" ] ; then
     ERLANG_NODE=$ERLANG_NODE_ARG
     NODE=${ERLANG_NODE%@*}
 fi
-if [ "{{release}}" != "true" ] ; then
-    if [ "$EJABBERDDIR" = "" ] ; then
-        EJABBERDDIR={{libdir}}/ejabberd
-    fi
-    if [ "$EJABBERD_PRIV_PATH" = "" ] ; then
-        EJABBERD_PRIV_PATH=$EJABBERDDIR/priv
-    fi
-    if [ "$EJABBERD_BIN_PATH" = "" ] ; then
-        EJABBERD_BIN_PATH=$EJABBERD_PRIV_PATH/bin
-    fi
+if [ "$EJABBERDDIR" = "" ] ; then
+    EJABBERDDIR={{libdir}}/ejabberd/ejabberd
+fi
+if [ "$EJABBERD_PRIV_PATH" = "" ] ; then
+    EJABBERD_PRIV_PATH=$EJABBERDDIR/priv
+fi
+if [ "$EJABBERD_BIN_PATH" = "" ] ; then
+    EJABBERD_BIN_PATH=$EJABBERD_PRIV_PATH/bin
 fi
 EJABBERD_LOG_PATH=$LOGS_DIR/ejabberd.log
 DATETIME=`date "+%Y%m%d-%H%M%S"`
@@ -166,7 +167,6 @@ start()
     $EXEC_CMD "$ERL \
       $NAME $ERLANG_NODE \
       -noinput -detached \
-      -pa $EJABBERD_EBIN_PATH \
       $MNESIA_OPTS \
       $KERNEL_OPTS \
       $EJABBERD_OPTS \
@@ -206,7 +206,6 @@ live()
     livewarning
     $EXEC_CMD "$ERL \
       $NAME $ERLANG_NODE \
-      -pa $EJABBERD_EBIN_PATH \
       $MNESIA_OPTS \
       $KERNEL_OPTS \
       $EJABBERD_OPTS \
@@ -220,7 +219,6 @@ iexlive()
     livewarning
     $EXEC_CMD "$IEX \
       $IEXNAME $ERLANG_NODE \
-      -pa $EJABBERD_EBIN_PATH \
       --erl \"-mnesia dir \\\"$SPOOL_DIR\\\"\" \
       --erl \"$KERNEL_OPTS\" \
       --erl \"$EJABBERD_OPTS\" \
@@ -290,7 +288,6 @@ ping()
     $EXEC_CMD "$ERL \
       $NAME ping-${TTY}-${ERLANG_NODE} \
       -hidden \
-      -pa $EJABBERD_EBIN_PATH \
       $KERNEL_OPTS $ERLANG_OPTS \
       -eval 'io:format(\"~p~n\",[net_adm:ping($1)])' \
       -s erlang halt -output text -noinput"
@@ -400,7 +397,6 @@ ctlexec()
       $NAME ${CONN_NAME} \
       -noinput \
       -hidden \
-      -pa $EJABBERD_EBIN_PATH \
       $KERNEL_OPTS \
       -s ejabberd_ctl -extra $ERLANG_NODE $COMMAND"
 }
