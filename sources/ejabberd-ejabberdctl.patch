diff -up ejabberd-16.02/ejabberdctl.template.ejabberdctl ejabberd-16.02/ejabberdctl.template
--- ejabberd-16.02/ejabberdctl.template.ejabberdctl	2016-02-29 13:35:45.000000000 +0000
+++ ejabberd-16.02/ejabberdctl.template	2016-03-02 10:57:20.982282814 +0000
@@ -7,15 +7,18 @@ ERL_MAX_PORTS=32000
 ERL_PROCESSES=250000
 ERL_MAX_ETS_TABLES=1400
 FIREWALL_WINDOW=""
-ERLANG_NODE=ejabberd@localhost
+ERLANG_NODE=ejabberd@`hostname -s 2>/dev/null || echo "localhost"`
 
 # define default environment variables
 SCRIPT_DIR=`cd ${0%/*} && pwd`
 ERL={{erl}}
 IEX={{bindir}}/iex
 EPMD={{bindir}}/epmd
-INSTALLUSER={{installuser}}
-ERL_LIBS={{libdir}}
+INSTALLUSER=ejabberd
+ERL_LIBS={{libdir}}/ejabberd
+
+# don't create world readable files
+umask 007
 
 # check the proper system user is used if defined
 if [ "$INSTALLUSER" != "" ] ; then
@@ -27,7 +30,7 @@ if [ "$INSTALLUSER" != "" ] ; then
                 mkdir -p "$INSTALLUSER_HOME"
                 chown "$INSTALLUSER" "$INSTALLUSER_HOME"
             fi
-            EXEC_CMD="su $INSTALLUSER -c"
+            EXEC_CMD="/sbin/runuser -s /bin/bash $INSTALLUSER -c"
         fi
     done
     if [ `id -g` -eq `id -g $INSTALLUSER` ] ; then
@@ -85,16 +88,14 @@ if [ "$ERLANG_NODE_ARG" != "" ] ; then
     ERLANG_NODE=$ERLANG_NODE_ARG
     NODE=${ERLANG_NODE%@*}
 fi
-if [ "{{release}}" != "true" ] ; then
-    if [ "$EJABBERDDIR" = "" ] ; then
-        EJABBERDDIR={{libdir}}/ejabberd
-    fi
-    if [ "$EJABBERD_PRIV_PATH" = "" ] ; then
-        EJABBERD_PRIV_PATH=$EJABBERDDIR/priv
-    fi
-    if [ "$EJABBERD_BIN_PATH" = "" ] ; then
-        EJABBERD_BIN_PATH=$EJABBERD_PRIV_PATH/bin
-    fi
+if [ "$EJABBERDDIR" = "" ] ; then
+    EJABBERDDIR={{libdir}}/ejabberd/ejabberd
+fi
+if [ "$EJABBERD_PRIV_PATH" = "" ] ; then
+    EJABBERD_PRIV_PATH=$EJABBERDDIR/priv
+fi
+if [ "$EJABBERD_BIN_PATH" = "" ] ; then
+    EJABBERD_BIN_PATH=$EJABBERD_PRIV_PATH/bin
 fi
 EJABBERD_LOG_PATH=$LOGS_DIR/ejabberd.log
 DATETIME=`date "+%Y%m%d-%H%M%S"`
