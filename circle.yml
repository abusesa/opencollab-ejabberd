machine:
  services:
    - docker
  python:
    version: 2.7.10

dependencies:
  pre:
    - pip install https://github.com/abusesa/github-release/archive/master.tar.gz
  override:
    - docker build --pull -t build-image .

test:
  pre:
    - mkdir output
  override:
    - docker run -ti -v `pwd`/output:/output --name build-container build-image

deployment:
  release:
    tag: /\d+(\.\d+)*(\-\d+)*/
    commands:
      - github-release "${GITHUB_API_TOKEN}" "${CIRCLE_PROJECT_USERNAME}" "${CIRCLE_PROJECT_REPONAME}" "${CIRCLE_TAG}" output/*
